- name: Unpack Binutils
  unarchive:
    remote_src: yes
    src: "{{ lfs_root }}/sources/binutils-{{ binutils_version }}.tar.xz"
    dest: "{{ lfs_root }}/sources"
    # src: "{{ lfs_root }}/sources/binutils-2.31.1.tar.xz"


- name: Create Build Directory for Bintuils
  file:
    path: "{{ lfs_root }}/sources/binutils-{{ binutils_version }}/build"
    state: directory
    # path: "{{ lfs_root }}/sources/binutils-2.31.1/build"


- name: Configure the Binutils Build
  shell: ../configure --prefix=/tools --with-sysroot=$LFS --with-lib-path=/tools/lib --target=$LFS_TGT --disable-nls --disable-werror
  args:
    chdir: "{{ lfs_root }}/sources/binutils-{{ binutils_version }}/build"
  environment:
    LFS: "{{ lfs.mnt_dir }}"
    # chdir: "{{ lfs_root }}/sources/binutils-2.31.1/build"


- name: Build Binutils
  shell: make -j 8
  args:
    chdir: "{{ lfs_root }}/sources/binutils-{{ binutils_version }}/build"
    # chdir: "{{ lfs_root }}/sources/binutils-2.31.1/build"


- name: Create the Lib Directory
  file:
    path: /tools/lib
    state: directory


- name: Create the Lib64 Symlink
  file:
    dest: /tools/lib64
    state: link
    src: /tools/lib


- name: Install Binutils
  shell: make install
  args:
    chdir: "{{ lfs_root }}/sources/binutils-{{ binutils_version }}/build"
    # chdir: "{{ lfs_root }}/sources/binutils-2.31.1/build"


- name: Clean the Source Directory
  file:
    path: "{{ lfs_root }}/sources/binutils-{{ binutils_version }}"
    state: absent
    # path: "{{ lfs_root }}/sources/binutils-2.31.1"


